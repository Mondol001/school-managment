<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ব্যবসা ব্যবস্থাপনা সিস্টেম - উন্নত শপিং ফাংশনালিটি সহ</title>
  <style>
    /* রিসেট ও বেসিক স্টাইল */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }
    .hidden {
      display: none;
    }
    
    header {
      background-color: #333;
      color: #fff;
      padding: 15px;
      text-align: center;
      position: relative;
    }
    .logout {
      position: absolute;
      right: 15px;
      top: 15px;
      cursor: pointer;
    }
    
    .container {
      display: flex;
      height: calc(100vh - 60px);
    }
    nav {
      background-color: #444;
      width: 200px;
      padding-top: 20px;
    }
    nav a {
      display: block;
      padding: 10px 15px;
      color: #fff;
      text-decoration: none;
    }
    nav a.active,
    nav a:hover {
      background-color: #666;
    }
    
    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    
    /* টেবিল ও ফর্ম */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    form {
      margin-bottom: 20px;
    }
    form input,
    form select,
    form button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
    }
    .btn {
      background-color: #333;
      color: #fff;
      border: none;
      cursor: pointer;
      padding: 10px;
    }
    .btn:hover {
      background-color: #555;
    }
    
    .stat {
      margin: 10px 0;
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
    }
    
    /* Login/Signup পেজ */
    .login-container {
      max-width: 400px;
      margin: 50px auto;
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
    }
    .login-container h2 {
      margin-bottom: 15px;
      text-align: center;
    }
    
    /* Orders (Shopping) মডিউল */
    .order-container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    .order-container > div {
      background: #fff;
      padding: 15px;
      border: 1px solid #ccc;
      flex: 1;
    }
    .order-container h3 {
      margin-bottom: 10px;
    }
    .cart-total {
      margin-top: 10px;
      font-weight: bold;
      text-align: right;
    }
    
    /* Invoice Modal */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      position: relative;
    }
    .close {
      position: absolute;
      right: 10px;
      top: 10px;
      font-size: 20px;
      cursor: pointer;
    }
    
    /* Responsive Design */
    @media(max-width: 768px) {
      .container {
        flex-direction: column;
      }
      nav {
        width: 100%;
        display: flex;
        overflow-x: auto;
      }
      nav a {
        flex: 1;
        text-align: center;
      }
      .order-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="login-page" class="login-container hidden">
    <h2>লগইন করুন</h2>
    <form id="login-form">
      <input type="text" id="login-username" placeholder="ইউজারনেম" required>
      <input type="password" id="login-password" placeholder="পাসওয়ার্ড" required>
      <button type="submit" class="btn">লগইন</button>
    </form>
    <p style="text-align:center;">নতুন ইউজার? <a href="#" id="show-signup">সাইন আপ করুন</a></p>
  </div>

  <!-- Signup Page -->
  <div id="signup-page" class="login-container hidden">
    <h2>সাইন আপ করুন</h2>
    <form id="signup-form">
      <input type="text" id="signup-username" placeholder="ইউজারনেম" required>
      <input type="password" id="signup-password" placeholder="পাসওয়ার্ড" required>
      <button type="submit" class="btn">সাইন আপ</button>
    </form>
    <p style="text-align:center;">আগেই ইউজার আছেন? <a href="#" id="show-login">লগইন করুন</a></p>
  </div>

  <!-- Main App -->
  <div id="app" class="hidden">
    <header>
      <span id="app-title">ব্যবসা ব্যবস্থাপনা সিস্টেম</span>
      <span class="logout" id="logout-btn">লগআউট</span>
    </header>
    <div class="container">
      <nav>
        <a href="#" data-view="dashboard" class="nav-link active">ড্যাশবোর্ড</a>
        <a href="#" data-view="products" class="nav-link">পণ্য</a>
        <a href="#" data-view="orders" class="nav-link">অর্ডার</a>
        <a href="#" data-view="customers" class="nav-link">গ্রাহক</a>
        <a href="#" data-view="reports" class="nav-link">রিপোর্ট</a>
        <a href="#" data-view="payments" class="nav-link">পেমেন্ট</a>
        <a href="#" data-view="settings" class="nav-link">সেটিংস</a>
      </nav>
      <div class="content">
        <!-- Dashboard -->
        <div id="view-dashboard" class="view">
          <h2>ড্যাশবোর্ড</h2>
          <div class="stat" id="stat-total-sales">মোট বিক্রয়: 0</div>
          <div class="stat" id="stat-total-orders">মোট অর্ডার: 0</div>
          <div class="stat" id="stat-total-customers">মোট গ্রাহক: 0</div>
          <div class="stat" id="stat-total-products">মোট পণ্য: 0</div>
        </div>

        <!-- Products Module -->
        <div id="view-products" class="view hidden">
          <h2>পণ্য ব্যবস্থাপনা</h2>
          <form id="product-form">
            <input type="text" id="product-name" placeholder="পণ্যের নাম" required>
            <input type="number" id="product-price" placeholder="দাম" required>
            <input type="number" id="product-qty" placeholder="পরিমাণ" required>
            <select id="product-category" required>
              <option value="">ক্যাটাগরি নির্বাচন করুন</option>
              <option value="ইলেকট্রনিক্স">ইলেকট্রনিক্স</option>
              <option value="কাপড়">কাপড়</option>
              <option value="খাদ্য">খাদ্য</option>
            </select>
            <button type="submit" class="btn">পণ্য যোগ করুন</button>
          </form>
          <table id="product-table">
            <thead>
              <tr>
                <th>নাম</th>
                <th>দাম</th>
                <th>পরিমাণ</th>
                <th>ক্যাটাগরি</th>
                <th>ক্রিয়া</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Orders Module (Shopping & Invoice) -->
        <div id="view-orders" class="view hidden">
          <h2>পণ্য থেকে অর্ডার করুন</h2>
          <div class="order-container">
            <!-- পণ্য তালিকা -->
            <div class="product-list">
              <h3>পণ্য তালিকা</h3>
              <table id="order-product-table">
                <thead>
                  <tr>
                    <th>নাম</th>
                    <th>দাম</th>
                    <th>স্টক</th>
                    <th>ক্রিয়া</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <!-- কার্ট সারাংশ -->
            <div class="cart-summary">
              <h3>কার্ট</h3>
              <table id="cart-table">
                <thead>
                  <tr>
                    <th>নাম</th>
                    <th>দাম</th>
                    <th>পরিমাণ</th>
                    <th>মোট</th>
                    <th>ক্রিয়া</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div class="cart-total">
                মোট: <span id="cart-total">0</span>
              </div>
              <button id="confirm-order-btn" class="btn">অর্ডার Now</button>
            </div>
          </div>
        </div>

        <!-- Customers Module -->
        <div id="view-customers" class="view hidden">
          <h2>গ্রাহক ব্যবস্থাপনা</h2>
          <form id="customer-form">
            <input type="text" id="customer-name" placeholder="গ্রাহকের নাম" required>
            <input type="text" id="customer-contact" placeholder="যোগাযোগ" required>
            <button type="submit" class="btn">গ্রাহক যোগ করুন</button>
          </form>
          <table id="customer-table">
            <thead>
              <tr>
                <th>নাম</th>
                <th>যোগাযোগ</th>
                <th>ক্রিয়া</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Reports Module -->
        <div id="view-reports" class="view hidden">
          <h2>রিপোর্ট</h2>
          <p>এখানে ব্যবসার সারাংশ দেখানো হবে:</p>
          <ul id="report-list"></ul>
        </div>

        <!-- Payments Module -->
        <div id="view-payments" class="view hidden">
          <h2>পেমেন্ট ব্যবস্থাপনা</h2>
          <table id="payment-table">
            <thead>
              <tr>
                <th>অর্ডার আইডি</th>
                <th>পণ্যসমূহ</th>
                <th>মোট দাম</th>
                <th>স্ট্যাটাস</th>
                <th>পরিশোধ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Settings Module -->
        <div id="view-settings" class="view hidden">
          <h2>সেটিংস</h2>
          <form id="settings-form">
            <input type="text" id="business-name" placeholder="ব্যবসার নাম" required>
            <input type="text" id="business-contact" placeholder="ব্যবসার যোগাযোগ" required>
            <input type="text" id="business-currency" placeholder="মুদ্রা (যেমন, ৳, $, €)" required>
            <button type="submit" class="btn">সেটিংস সেভ করুন</button>
          </form>
          <div id="settings-display"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Invoice Modal -->
  <div id="invoice-modal" class="modal hidden">
    <div class="modal-content">
      <span id="close-invoice" class="close">&times;</span>
      <div id="invoice-content"></div>
      <button id="print-invoice" class="btn">প্রিন্ট করুন</button>
    </div>
  </div>

  <script>
    /* -------- Local Storage ইউটিলিটি -------- */
    const Storage = {
      get: key => JSON.parse(localStorage.getItem(key)) || (key === 'settings' ? {} : []),
      set: (key, data) => localStorage.setItem(key, JSON.stringify(data))
    };

    /* -------- Authentication Module -------- */
    const Auth = {
      currentUser: null,
      login: (username, password) => {
        const users = Storage.get('users');
        const user = users.find(u => u.username === username && u.password === password);
        if (user) {
          Auth.currentUser = user;
          localStorage.setItem('currentUser', JSON.stringify(user));
          return true;
        }
        return false;
      },
      signup: (username, password) => {
        let users = Storage.get('users');
        if (users.find(u => u.username === username)) {
          alert('ইউজারনেম ইতিমধ্যেই আছে!');
          return false;
        }
        const newUser = { username, password };
        users.push(newUser);
        Storage.set('users', users);
        return true;
      },
      logout: () => {
        Auth.currentUser = null;
        localStorage.removeItem('currentUser');
      },
      checkAuth: () => {
        const user = localStorage.getItem('currentUser');
        if (user) {
          Auth.currentUser = JSON.parse(user);
          return true;
        }
        return false;
      }
    };

    /* -------- Data Management Classes -------- */
    class ProductManager {
      constructor() { this.products = Storage.get('products'); }
      add(product) {
        this.products.push(product);
        Storage.set('products', this.products);
      }
      delete(index) {
        this.products.splice(index, 1);
        Storage.set('products', this.products);
      }
    }
    class OrderManager {
      constructor() { this.orders = Storage.get('orders'); }
      add(order) {
        order.id = Date.now();
        order.date = new Date().toLocaleString();
        this.orders.push(order);
        Storage.set('orders', this.orders);
      }
      delete(index) {
        this.orders.splice(index, 1);
        Storage.set('orders', this.orders);
      }
    }
    class CustomerManager {
      constructor() { this.customers = Storage.get('customers'); }
      add(customer) {
        this.customers.push(customer);
        Storage.set('customers', this.customers);
      }
      delete(index) {
        this.customers.splice(index, 1);
        Storage.set('customers', this.customers);
      }
    }
    class SettingsManager {
      constructor() { this.settings = Storage.get('settings'); }
      update(settings) {
        this.settings = settings;
        Storage.set('settings', this.settings);
      }
    }

    /* -------- Initialize Managers -------- */
    const productManager = new ProductManager();
    const orderManager = new OrderManager();
    const customerManager = new CustomerManager();
    const settingsManager = new SettingsManager();

    /* -------- Navigation Handling -------- */
    const navLinks = document.querySelectorAll('.nav-link');
    const views = document.querySelectorAll('.view');
    navLinks.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const target = link.getAttribute('data-view');
        switchView(target);
      });
    });
    function switchView(viewId) {
      views.forEach(view => {
        view.id === 'view-' + viewId
          ? view.classList.remove('hidden')
          : view.classList.add('hidden');
      });
      navLinks.forEach(link => {
        link.getAttribute('data-view') === viewId
          ? link.classList.add('active')
          : link.classList.remove('active');
      });
      if (viewId === 'dashboard') updateDashboard();
      if (viewId === 'reports') generateReports();
      if (viewId === 'settings') displaySettings();
      if (viewId === 'payments') renderPayments();
      if (viewId === 'products') renderProducts();
      if (viewId === 'customers') renderCustomers();
      if (viewId === 'orders') {
        renderOrderProductList();
        renderCart();
      }
    }

    /* -------- Logout Handler -------- */
    document.getElementById('logout-btn').addEventListener('click', () => {
      Auth.logout();
      showLogin();
    });

    /* -------- Authentication UI Handling -------- */
    const loginPage = document.getElementById('login-page');
    const signupPage = document.getElementById('signup-page');
    const appPage = document.getElementById('app');

    document.getElementById('login-form').addEventListener('submit', e => {
      e.preventDefault();
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      if (Auth.login(username, password)) {
        showApp();
      } else {
        alert('ভুল ইউজারনেম বা পাসওয়ার্ড!');
      }
    });
    document.getElementById('signup-form').addEventListener('submit', e => {
      e.preventDefault();
      const username = document.getElementById('signup-username').value;
      const password = document.getElementById('signup-password').value;
      if (Auth.signup(username, password)) {
        alert('সাইন আপ সফল। এখন লগইন করুন।');
        showLogin();
      }
    });
    document.getElementById('show-signup').addEventListener('click', e => {
      e.preventDefault();
      loginPage.classList.add('hidden');
      signupPage.classList.remove('hidden');
    });
    document.getElementById('show-login').addEventListener('click', e => {
      e.preventDefault();
      signupPage.classList.add('hidden');
      loginPage.classList.remove('hidden');
    });
    function showLogin() {
      loginPage.classList.remove('hidden');
      signupPage.classList.add('hidden');
      appPage.classList.add('hidden');
    }
    function showApp() {
      loginPage.classList.add('hidden');
      signupPage.classList.add('hidden');
      appPage.classList.remove('hidden');
      switchView('dashboard');
    }
    if (Auth.checkAuth()) {
      showApp();
    } else {
      showLogin();
    }

    /* -------- Render Functions -------- */
    function renderProducts() {
      const tbody = document.querySelector('#product-table tbody');
      tbody.innerHTML = '';
      productManager.products.forEach((product, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${product.name}</td>
          <td>${product.price}</td>
          <td>${product.qty}</td>
          <td>${product.category}</td>
          <td>
            <button class="btn" onclick="editProduct(${index})">সম্পাদনা</button>
            <button class="btn" onclick="deleteProduct(${index})">মুছে ফেলুন</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
    function renderCustomers() {
      const tbody = document.querySelector('#customer-table tbody');
      tbody.innerHTML = '';
      customerManager.customers.forEach((customer, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${customer.name}</td>
          <td>${customer.contact}</td>
          <td><button class="btn" onclick="deleteCustomer(${index})">মুছে ফেলুন</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    function updateDashboard() {
      document.getElementById('stat-total-sales').textContent = 'মোট বিক্রয়: ' + calculateTotalSales();
      document.getElementById('stat-total-orders').textContent = 'মোট অর্ডার: ' + orderManager.orders.length;
      document.getElementById('stat-total-customers').textContent = 'মোট গ্রাহক: ' + customerManager.customers.length;
      document.getElementById('stat-total-products').textContent = 'মোট পণ্য: ' + productManager.products.length;
    }
    function calculateTotalSales() {
      let total = 0;
      orderManager.orders.forEach(order => {
        if (order.status === 'completed') {
          order.items.forEach(item => {
            total += item.price * item.qty;
          });
        }
      });
      return total;
    }
    function generateReports() {
      const reportList = document.getElementById('report-list');
      reportList.innerHTML = '';
      const reportItems = [
        'মোট বিক্রয়: ' + calculateTotalSales(),
        'মোট অর্ডার: ' + orderManager.orders.length,
        'মোট গ্রাহক: ' + customerManager.customers.length,
        'মোট পণ্য: ' + productManager.products.length
      ];
      reportItems.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        reportList.appendChild(li);
      });
    }
    function renderPayments() {
      const tbody = document.querySelector('#payment-table tbody');
      tbody.innerHTML = '';
      orderManager.orders.forEach((order, index) => {
        const total = order.items.reduce((sum, item) => sum + (item.price * item.qty), 0);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${order.id}</td>
          <td>${order.items.map(i => i.name).join(', ')}</td>
          <td>${total}</td>
          <td>${order.status}</td>
          <td>
            ${order.status === 'pending'
              ? `<button class="btn" onclick="payOrder(${index})">পরিশোধ করুন</button>`
              : 'পরিশোধিত'}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
    function displaySettings() {
      const display = document.getElementById('settings-display');
      const s = settingsManager.settings;
      display.innerHTML = s.businessName
        ? `
          <p><strong>ব্যবসার নাম:</strong> ${s.businessName}</p>
          <p><strong>যোগাযোগ:</strong> ${s.businessContact}</p>
          <p><strong>মুদ্রা:</strong> ${s.businessCurrency}</p>
        `
        : '<p>কোনো সেটিংস নেই।</p>';
    }

    /* -------- Form Submissions -------- */
    document.getElementById('product-form').addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('product-name').value;
      const price = parseFloat(document.getElementById('product-price').value);
      const qty = parseInt(document.getElementById('product-qty').value, 10);
      const category = document.getElementById('product-category').value;
      productManager.add({ name, price, qty, category });
      e.target.reset();
      renderProducts();
      updateDashboard();
    });
    document.getElementById('customer-form').addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('customer-name').value;
      const contact = document.getElementById('customer-contact').value;
      customerManager.add({ name, contact });
      e.target.reset();
      renderCustomers();
      updateDashboard();
    });
    document.getElementById('settings-form').addEventListener('submit', e => {
      e.preventDefault();
      const businessName = document.getElementById('business-name').value;
      const businessContact = document.getElementById('business-contact').value;
      const businessCurrency = document.getElementById('business-currency').value;
      settingsManager.update({ businessName, businessContact, businessCurrency });
      e.target.reset();
      displaySettings();
    });

    /* -------- Delete & Edit Handlers -------- */
    window.deleteProduct = index => {
      productManager.delete(index);
      renderProducts();
      updateDashboard();
    };
    window.editProduct = index => {
      const p = productManager.products[index];
      document.getElementById('product-name').value = p.name;
      document.getElementById('product-price').value = p.price;
      document.getElementById('product-qty').value = p.qty;
      document.getElementById('product-category').value = p.category;
      productManager.delete(index);
      renderProducts();
      switchView('products');
    };
    window.deleteCustomer = index => {
      customerManager.delete(index);
      renderCustomers();
      updateDashboard();
    };
    window.payOrder = index => {
      orderManager.orders[index].status = 'completed';
      Storage.set('orders', orderManager.orders);
      renderPayments();
      updateDashboard();
    };

    /* ===== Orders (Shopping Cart & Invoice) Module ===== */
    let cart = []; // কার্ট

    function renderOrderProductList() {
      const tbody = document.querySelector('#order-product-table tbody');
      tbody.innerHTML = '';
      productManager.products.forEach((product, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${product.name}</td>
          <td>${product.price}</td>
          <td>${product.qty}</td>
          <td>
            <button class="btn" onclick="addToCart(${index})">কার্টে যোগ করুন</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
    function addToCart(productIndex) {
      const product = productManager.products[productIndex];
      const existing = cart.find(item => item.index === productIndex);
      if (existing) {
        existing.qty++;
      } else {
        cart.push({
          index: productIndex,
          name: product.name,
          price: product.price,
          qty: 1
        });
      }
      renderCart();
    }
    function renderCart() {
      const tbody = document.querySelector('#cart-table tbody');
      tbody.innerHTML = '';
      let total = 0;
      cart.forEach((item, idx) => {
        const sub = item.price * item.qty;
        total += sub;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td>${item.qty}</td>
          <td>${sub}</td>
          <td><button class="btn" onclick="removeFromCart(${idx})">মুছে ফেলুন</button></td>
        `;
        tbody.appendChild(tr);
      });
      document.getElementById('cart-total').textContent = total;
    }
    function removeFromCart(idx) {
      cart.splice(idx, 1);
      renderCart();
    }
    function confirmOrder() {
      if (cart.length === 0) {
        alert('কার্ট খালি আছে!');
        return;
      }
      const order = {
        items: cart.map(item => ({
          name: item.name,
          price: item.price,
          qty: item.qty
        })),
        status: 'pending'
      };
      orderManager.add(order);

      // Invoice HTML তৈরি
      let invoiceHTML = `<h2>Invoice</h2>
        <p><strong>অর্ডার আইডি:</strong> ${order.id}</p>
        <p><strong>তারিখ:</strong> ${order.date}</p>
        <table style="width:100%; border-collapse: collapse;" border="1">
          <thead>
            <tr>
              <th>নাম</th>
              <th>ইউনিট দাম</th>
              <th>পরিমাণ</th>
              <th>সাবটোটাল</th>
            </tr>
          </thead>
          <tbody>`;
      let grandTotal = 0;
      order.items.forEach(item => {
        const subTotal = item.price * item.qty;
        grandTotal += subTotal;
        invoiceHTML += `<tr>
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td>${item.qty}</td>
          <td>${subTotal}</td>
        </tr>`;
      });
      invoiceHTML += `</tbody></table>
        <h3 style="text-align:right;">গ্র্যান্ড টোটাল: ${grandTotal}</h3>`;
      
      document.getElementById('invoice-content').innerHTML = invoiceHTML;
      cart = [];
      renderCart();
      document.getElementById('invoice-modal').classList.remove('hidden');
      updateDashboard();
      renderPayments();
    }
    document.getElementById('confirm-order-btn').addEventListener('click', confirmOrder);

    /* Invoice Modal Close & Print */
    document.getElementById('close-invoice').addEventListener('click', () => {
      document.getElementById('invoice-modal').classList.add('hidden');
    });
    document.getElementById('print-invoice').addEventListener('click', () => {
      window.print();
    });

    /* গ্লোবাল এক্সপোজার (inline onclick এর জন্য) */
    window.addToCart = addToCart;
  </script>
</body>
</html>
